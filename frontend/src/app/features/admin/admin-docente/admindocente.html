<div class="admin-docente-container">
  <h2>Gestión de Docentes</h2>
  
  <!-- Mensaje de éxito o error -->
  @if (mensaje) {
    <div class="alert alert-success">{{ mensaje }}</div>
  }
  
  @if (error) {
    <div class="alert alert-danger">{{ error }}</div>
  }
  
  <!-- Botones de acción principal -->
  <div class="acciones-container">
    <button class="btn btn-primary" (click)="toggleMostrarUsuarios()">
      {{ mostrarUsuariosRegulares ? 'Ver Docentes' : 'Asignar Rol Docente' }}
    </button>
  </div>
  
  <!-- Indicador de carga -->
  @if (loading) {
    <div class="spinner">Cargando...</div>
  }

  <!-- Lista de docentes actuales con búsqueda -->
  @if (!mostrarUsuariosRegulares && !loading && !error) {
    <div class="docentes-container">
      <h3>Docentes Actuales</h3>
      
      <!-- Filtros de búsqueda -->
      <div class="filtros-container">
        <div class="busqueda">
          <input 
            type="text" 
            placeholder="Buscar por nombre, email o legajo..." 
            (input)="onSearch($any($event.target).value)" 
            class="search-input"
          >
        </div>
        
        <div class="filtros">
          <select (change)="filtrarPorEstado($any($event.target).value)">
            <option value="">Todos los estados</option>
            <option value="Activo">Activo</option>
            <option value="Inactivo">Inactivo</option>
          </select>
          
          <select (change)="filtrarPorArea($any($event.target).value)">
            <option value="">Todas las Areas</option>
            <option value="Matemáticas">Matemáticas</option>
            <option value="Ciencias Naturales">Ciencias Naturales</option>
            <option value="Ciencias Sociales">Ciencias Sociales</option>
            <option value="Lengua">Lengua</option>
            <option value="LLengua extranjera">Lengua extranjera</option>

          </select>
        </div>
      </div>
      
      <!-- Tabla de resultados -->
      <table class="table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Legajo</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (docente of docentes; track docente.id) {
            <tr>
              <td>{{ docente.name }}</td>
              <td>{{ docente.email }}</td>
              <td>{{ docente.legajo }}</td>
              <td>{{ docente.estado }}</td>
              <td class="actions-cell">
                <button class="btn btn-sm btn-secondary" (click)="editarDocente(docente)">
                  <i class="fas fa-edit"></i> Editar
                </button>
                
                <button class="btn btn-sm btn-info" (click)="asignarMateria(docente.id)">
                  Asignar Materia
                </button>
                
                <button class="btn btn-sm btn-danger admin-btn" 
                        (click)="promoverAAdmin(docente.id, docente.name)">
                  Promover a Admin
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="text-center">
                {{ terminoBusqueda ? 'No se encontraron docentes con ese criterio' : 'No hay docentes registrados' }}
              </td>
            </tr>
          }
        </tbody>
      </table>
      
      <!-- Paginación simple -->
      @if (docentes.length > 0) {
        <div class="pagination">
          <button 
            [disabled]="currentPage === 1" 
            (click)="cambiarPagina(currentPage - 1)"
          >
            Anterior
          </button>
          <span>Página {{ currentPage }}</span>
          <button (click)="cambiarPagina(currentPage + 1)">
            Siguiente
          </button>
        </div>
      }
    </div>
  }

  <!-- Vista para asignar roles de docente -->
  @if (mostrarUsuariosRegulares && !loading && !error) {
    <div class="usuarios-container">
      <h3>Usuarios Registrados</h3>
      <p>Selecciona los usuarios a los que deseas asignar el rol de docente:</p>
      
      <table class="table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Legajo</th>
            <th>Fecha Registro</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (usuario of usuariosRegulares; track usuario.id) {
            <tr>
              <td>{{ usuario.name }}</td>
              <td>{{ usuario.email }}</td>
              <td>{{ usuario.legajo || 'No asignado' }}</td>
              <td>{{ usuario.created_at | date }}</td>
              <td>
                <div class="btn-group">
                  <button class="btn btn-sm btn-primary" (click)="asignarRolDocente(usuario.id)">
                    Convertir a Docente
                  </button>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" class="text-center">No hay usuarios disponibles para asignar</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Modal de Edición de Docente -->
  @if (docenteEditando) {
    <div class="modal-overlay" (click)="cancelarEdicion()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Editar Docente</h3>
          <button class="close-btn" (click)="cancelarEdicion()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <form [formGroup]="formularioEdicion" (ngSubmit)="actualizarDocente()">
          <div class="modal-body">
            @if (errorModal) {
              <div class="alert alert-danger">{{ errorModal }}</div>
            }
            
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre Completo *</label>
                <input 
                  type="text" 
                  class="form-control"
                  formControlName="nombre"
                  [class.is-invalid]="formularioEdicion.get('nombre')?.invalid && formularioEdicion.get('nombre')?.touched">
                @if (formularioEdicion.get('nombre')?.invalid && formularioEdicion.get('nombre')?.touched) {
                  <div class="invalid-feedback">
                    El nombre es requerido y debe tener al menos 2 caracteres
                  </div>
                }
              </div>

              <div class="form-group">
                <label>Email</label>
                <input 
                  type="email" 
                  class="form-control"
                  formControlName="email"
                  readonly>
                <small class="form-text text-muted">El email no puede ser modificado</small>
              </div>

              <div class="form-group">
                <label>Legajo *</label>
                <input 
                  type="text" 
                  class="form-control"
                  formControlName="legajo"
                  [class.is-invalid]="formularioEdicion.get('legajo')?.invalid && formularioEdicion.get('legajo')?.touched">
                @if (formularioEdicion.get('legajo')?.invalid && formularioEdicion.get('legajo')?.touched) {
                  <div class="invalid-feedback">
                    El legajo es requerido
                  </div>
                }
              </div>

              <div class="form-group">
                <label>DNI *</label>
                <input 
                  type="text" 
                  class="form-control"
                  formControlName="dni"
                  [class.is-invalid]="formularioEdicion.get('dni')?.invalid && formularioEdicion.get('dni')?.touched">
                @if (formularioEdicion.get('dni')?.invalid && formularioEdicion.get('dni')?.touched) {
                  <div class="invalid-feedback">
                    DNI debe tener entre 7 y 8 dígitos
                  </div>
                }
              </div>

              <div class="form-group">
                <label>Fecha de Nacimiento *</label>
                <input 
                  type="date" 
                  class="form-control"
                  formControlName="fechaNacimiento"
                  [class.is-invalid]="formularioEdicion.get('fechaNacimiento')?.invalid && formularioEdicion.get('fechaNacimiento')?.touched">
                @if (formularioEdicion.get('fechaNacimiento')?.invalid && formularioEdicion.get('fechaNacimiento')?.touched) {
                  <div class="invalid-feedback">
                    La fecha de nacimiento es requerida
                  </div>
                }
              </div>

              <div class="form-group">
                <label>Domicilio *</label>
                <input 
                  type="text" 
                  class="form-control"
                  formControlName="domicilio"
                  [class.is-invalid]="formularioEdicion.get('domicilio')?.invalid && formularioEdicion.get('domicilio')?.touched">
                @if (formularioEdicion.get('domicilio')?.invalid && formularioEdicion.get('domicilio')?.touched) {
                  <div class="invalid-feedback">
                    El domicilio es requerido (mínimo 5 caracteres)
                  </div>
                }
              </div>

              <div class="form-group">
                <label>Teléfono *</label>
                <input 
                  type="text" 
                  class="form-control"
                  formControlName="telefono"
                  [class.is-invalid]="formularioEdicion.get('telefono')?.invalid && formularioEdicion.get('telefono')?.touched">
                @if (formularioEdicion.get('telefono')?.invalid && formularioEdicion.get('telefono')?.touched) {
                  <div class="invalid-feedback">
                    Teléfono debe tener entre 10 y 15 dígitos
                  </div>
                }
              </div>

              <div class="form-group">
                <label>Estado *</label>
                <select class="form-control" formControlName="estado">
                  <option value="Activo">Activo</option>
                  <option value="Inactivo">Inactivo</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="cancelarEdicion()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="!formularioEdicion.valid || guardandoCambios">
              @if (guardandoCambios) {
                <i class="fas fa-spinner fa-spin"></i> Guardando...
              } @else {
                <i class="fas fa-save"></i> Guardar Cambios
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>